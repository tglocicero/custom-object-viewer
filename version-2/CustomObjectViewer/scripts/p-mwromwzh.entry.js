import{r as t,g as s,c as i,h,H as e}from"./p-2f2b281e.js";import{D as n,b as r}from"./p-3954dba3.js";import{i as o,e as a,d as c,j as l}from"./p-9158fc11.js";import{T as u}from"./p-c94dc661.js";import{T as d,p as m,d as p,e as w,i as f,f as y}from"./p-76bb3e24.js";import{F as g,C as j}from"./p-6a7872fb.js";import{a as b,R as v}from"./p-98dca4e3.js";const C=class{constructor(s){t(this,s),this.dataType="string",this.defaultValue="",this.editable=!0,this.filterable=!0,this.filterTypes=g,this.groupKey="items",this.headerRenderer=j.renderHeader,this.internal=!1,this.pinnable=!0,this.pinned=null,this.orderable=!0,this.rules=[],this.selectable=!0,this.sizable=!0,this.sortable=!0,this.width="auto",this.visible=!0}injectedPropWatcher(){this.configEditRenderer()}componentWillLoad(){this.renderer=new j(this.element),this.name||(this.name=j.generateColumnName(this.field,this.caption)),this.cellRenderer||(this.cellRenderer=j.renderCell),this.configEditRenderer()}componentDidLoad(){this.table=this.element.closest("anj-table")}onOptionsLoaded({target:t}){this.options=t}onValidationRuleLoaded({target:t}){this.rules.push(t)}async contextMenu(){return this.renderer.contextMenu()}async setOffset(t){return this.renderer.setOffset(t)}async setWidth(t){return this.renderer.setWidth(t)}async initCell(t,s){return this.renderer.initCell(t,s)}configEditRenderer(){(!this.editRenderer||!this.editRenderer.isDefault)&&this.editRenderer||(this.editRenderer=j.renderEdit.bind({translator:this.translator}),this.editRenderer.isDefault=!0)}get element(){return s(this)}static get watchers(){return{translator:["injectedPropWatcher"]}}};u.injectProps(C,["translator"]);const L=class{constructor(s){t(this,s),this.clickListener=t=>this.onSort(t),this.keyListener=o(this.onSort.bind(this)),this.dropListener=t=>this.onDrop(t),this.resizing=!1,this.anjReorder=i(this,"anjReorder",7),this.anjPin=i(this,"anjPin",7),this.anjSort=i(this,"anjSort",7)}async componentWillLoad(){this.table=this.column.table,this.parentEl=this.element.parentElement,this.parentEl.addEventListener("click",this.clickListener),this.parentEl.addEventListener("keyup",this.keyListener),this.parentEl.addEventListener("anjDrop",this.dropListener),this.table.orderable&&this.column.orderable&&(this.dragController=new n(this.parentEl,{currentIndex:this.columnIndex()}),this.dropController=new r(this.parentEl),this.dragController.connect(),this.dropController.connect())}componentDidUnload(){this.dragController&&this.dragController.disconnect(),this.dragController&&this.dropController.disconnect(),this.parentEl.removeEventListener("click",this.clickListener),this.parentEl.removeEventListener("keyup",this.keyListener),this.parentEl.removeEventListener("anjDrop",this.dropListener)}onSort(t){this.field&&!this.resizing&&this.column.sortable&&!R(t)&&this.anjSort.emit({field:this.field,order:this.sortIndex>-1&&"asc"===this.sortOrder?"desc":"asc"})}async onContextSelection({detail:t}){this.anjPin.emit({index:this.columnIndex(),pin:t})}onResizeStart(){this.resizing=!0}onResizeEnd(){this.resizing=!1}onDrop({detail:t}){t.targetIndex=this.columnIndex(),this.anjReorder.emit(t)}columnIndex(){return parseInt(this.parentEl.dataset.columnIndex,10)}render(){return[this.column.field&&this.column.sortable?h("svg",{class:"anj-sort-icon",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24"},"asc"===this.sortOrder?[h("path",{fill:"none",d:"M0 0h24v24H0V0z"}),h("path",{fill:"currentColor",d:"M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"})]:[h("path",{fill:"none",d:"M0 0h24v24H0V0z"}),h("path",{fill:"currentColor",d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"})]):void 0,this.table.sizable&&this.column.sizable?h("anj-column-sizer",null):void 0,h("anj-context-menu",{attach:this.parentEl,loader:()=>this.column.contextMenu()})]}get element(){return s(this)}static get style(){return"anj-table .anj-header-cell.anj-dragging,anj-table .anj-header-cell.anj-dragover{border-bottom-color:var(--anj-highlight)!important}anj-table .anj-header-cell.anj-dragging anj-column-sizer,anj-table .anj-header-cell.anj-dragover anj-column-sizer{display:none}anj-table .anj-header-cell.anj-dragging{opacity:.5}anj-table .anj-header-cell.anj-sorted .anj-sort-icon{opacity:1;-webkit-transition:opacity .3s ease;transition:opacity .3s ease}anj-column-control .anj-sort-icon{color:var(--anj-text-medium);display:inline-block;font-size:.625rem;font-weight:700;line-height:.8;opacity:0;position:relative;top:-4px;-webkit-transition:opacity 0s;transition:opacity 0s}"}},R=t=>!!t&&!!t.composedPath().find(t=>t.matches&&t.matches("anj-column-filter-toggle")),D=class{constructor(s){t(this,s),this.resizeListener=({movementX:t})=>this.onResize(t),this.resizeEndListener=()=>this.onResizeEnd(),this.anjResizeStart=i(this,"anjResizeStart",7),this.anjResizeEnd=i(this,"anjResizeEnd",7)}componentDidLoad(){this.parentHeader=this.element.parentElement.parentElement,this.table=this.element.closest("table")}onMousedown(t){t.preventDefault()}onMouseDown(t){t.preventDefault(),t.stopPropagation(),this.column=this.findColumn(this.parentHeader),this.siblingHeader=this.findSiblingHeader(this.column),this.siblingColumn=this.findColumn(this.siblingHeader),this.width=this.parentHeader.offsetWidth,this.siblingWidth=this.siblingHeader.offsetWidth,this.setDisplayHeight(this.table.parentElement),this.anjResizeStart.emit(),this.table.addEventListener("mousemove",this.resizeListener),this.table.addEventListener("mouseup",this.resizeEndListener)}onResizeEnd(){return this.table.removeEventListener("mousemove",this.resizeListener),this.table.removeEventListener("mouseup",this.resizeEndListener),new Promise(t=>{window.setTimeout(()=>{this.setDisplayHeight(),this.anjResizeEnd.emit(),t()})})}onResize(t){0!==t&&(this.width="right"===this.column.pinned?this.width-t:this.width+t,this.siblingWidth="right"===this.column.pinned?this.siblingWidth+t:this.siblingWidth-t,this.width<40||this.siblingWidth<40||(this.column.setWidth(`${this.width}px`),this.siblingColumn.setWidth(`${this.siblingWidth}px`),this.siblingColumn.pinned===this.column.pinned&&this.siblingColumn.setOffset(`${this.width}px`)))}findColumn(t){return t.querySelector("anj-column-control").column}findSiblingHeader(t){return"right"===t.pinned?this.parentHeader.previousSibling:this.parentHeader.nextSibling}setDisplayHeight(t){this.element.style.height=t?`${t.offsetHeight}px`:"100%"}get element(){return s(this)}static get style(){return"anj-column-sizer{background-color:var(--anj-border);cursor:col-resize;display:block;height:100%;position:absolute;right:0;opacity:0;top:0;-webkit-transition:opacity .3s ease;transition:opacity .3s ease;width:.25rem;z-index:3}anj-column-sizer:active{background-color:var(--anj-highlight);opacity:.5}anj-table .anj-header-cell:last-child:not(.anj-pinned-right) anj-column-sizer{display:none}anj-table .anj-header-cell:hover anj-column-sizer{opacity:.5}anj-table .anj-header-cell.anj-pinned-right anj-column-sizer{left:0;right:auto}anj-table .anj-header-cell.anj-pinned-right~.anj-pinned-right{right:0}"}},T=["top","right","bottom","left","width","height"];class x{constructor(t,s,i){this.element=t,this.cb=s,this.supported="undefined"!=typeof ResizeObserver,this.onTransitionEnd=this.onTransitionEnd.bind(this),a&&(this.cb=a(this.cb,i))}connect(){this.supported?(this.resizeObserver=new ResizeObserver(()=>{this.cb()}),this.resizeObserver.observe(this.element)):(window.addEventListener("resize",this.cb),document.addEventListener("transitionend",this.onTransitionEnd))}disconnect(){this.supported||(window.removeEventListener("resize",this.cb),document.removeEventListener("transitionend",this.onTransitionEnd)),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=void 0)}onDidRender(){this.supported||this.cb()}onTransitionEnd({propertyName:t}){T.includes(t)&&this.cb()}}const E=class{constructor(s){t(this,s),this.scrollListener=t=>this.onScroll(t),this.overflowX=!1,this.delay=200,this.mode="none",this.total=1}onTotalChange(){this.calculateHeight()}connectedCallback(){this.calculateHeight(),this.resizer=new x(this.element,this.onResize.bind(this),50),this.resizer.connect(),"none"!==this.mode&&this.element.addEventListener("scroll",this.scrollListener)}componentDidRender(){this.resizer.onDidRender()}disconnectedCallback(){window.clearTimeout(this.scrollTimer),window.clearTimeout(this.resizeTimer),"none"!==this.mode&&this.element.removeEventListener("scroll",this.scrollListener),this.resizer.disconnect(),this.resizer=void 0}onResize(){const t=this.element.querySelector(".anj-table");this.element.parentElement.offsetWidth&&(this.width=this.element.parentElement.offsetWidth,this.overflowX=t&&t.offsetWidth>this.width)}doResize(){return window.clearTimeout(this.resizeTimer),new Promise(t=>{this.scrollTimer=window.setTimeout(()=>{this.onResize(),t()},this.delay)})}debouncedScrollTo(t,s){return window.clearTimeout(this.scrollTimer),new Promise(i=>{this.scrollTimer=window.setTimeout(()=>{void 0!==t&&(this.element.scrollLeft=t),void 0!==s&&(this.element.scrollTop=s),i()},this.delay)})}calculateHeight(){"none"!==this.mode&&(console.log(this.total),this.height=49*this.total,this.calculateRange())}calculateRange(){this.range=[0,10]}onScroll(t){console.log(t,this.scrollPane)}render(){const t={};return this.height&&(t.height=`${this.height}px`),h(e,{class:{"anj-overflow-x":this.overflowX}},h("div",{class:"anj-scroll-container",style:t,ref:t=>this.scrollPane=t},h("slot",null)))}get element(){return s(this)}static get watchers(){return{total:["onTotalChange"]}}static get style(){return".sc-anj-scroller-h{display:block;max-height:100%;overflow:auto;scroll-behavior:smooth}.sc-anj-scroller-h, .sc-anj-scroller-h .anj-scroll-container.sc-anj-scroller{background-color:inherit}"}},O=()=>{"undefined"==typeof window&&addEventListener("message",s=>{if(!s)return;const[i,h]=s.data;self.postMessage(t(h,i))},!1);const t=(t,i)=>{let h="data";return i.filter&&(h="filtered",t.filtered=t.data.filter(t=>s(t,i.filter)),t.total=t.filtered.length),(i.sort||i.group)&&(t[h]=l(t[h],i.group?i.group.concat(i.sort?i.sort:[]):i.sort),"data"===h&&(t.total=t.data.length)),i.group&&(t.filtered=a(t[h],i.group[0],i.size),t.total=t.filtered.length),t},s=(t,s)=>{let r=!0;for(let a=0;a<s.length&&(r=s[a].key?"string"==typeof s[a].query?h(t[s[a].key],s[a].query.trim().toLowerCase(),s[a].type):o(s[a].query)?n(t[s[a].key],s[a].query,s[a].type):e(t[s[a].key],s[a].query,s[a].type):i(t,s[a].query.trim().toLowerCase()));a++);return r},i=(t,s)=>{let i=!1;for(const e in t)if(t.hasOwnProperty(e)&&(i=h(`${t[e]}`,s)))break;return i},h=(t,s,i)=>{if(!t)return!1;const h=t.toLowerCase();switch(i){case"equals":return h===s;case"ends-with":return h.indexOf(s)===h.length-s.length;case"starts-with":return 0===h.indexOf(s);default:return h.includes(s)}},e=(t,s,i)=>{const h=r(t);if(!h)return!1;switch(i){case"contains":return h>=s[0].valueOf()&&h<=s[1].valueOf();case"ends-with":return h<=s.valueOf();case"starts-with":return h>=s.valueOf();default:return h===s.valueOf()}},n=(t,s,i)=>{if(!t)return!1;switch(i){case"contains":return t>=s[0]&&t<=s[1];case"ends-with":return t<=s;case"starts-with":return t>=s;default:return t===s}},r=t=>{if(t)return"function"==typeof t.getMonth?t.valueOf():new Date(t).valueOf()},o=t=>"number"==typeof(Array.isArray(t)?t[0]:t),a=(t,s,i)=>{const h=[],e={};let n,r;return t.forEach(t=>{e[t[s.key]]||(e[t[s.key]]=[0],(n={})[s.groupKey]=e[t[s.key]],n[s.key]=t[s.key],r=c(s,t),h.push(n)),r&&h.length>0&&h.length%i==0&&h.push(n),r&&(h.push(t),e[t[s.key]][0]=e[t[s.key]][0]+1)}),h},c=(t,s)=>t.groupKeys?t.autoExpand?!t.groupKeys.includes(s[t.key]):t.groupKeys.includes(s[t.key]):t.autoExpand,l=(t,s)=>t.sort((t,i)=>u(t,i,s)),u=(t,s,i)=>{let h=0;for(let e=0;e<i.length;e++){const n=t[i[e].key],r=s[i[e].key];if(0!==(h="string"==typeof n?n.localeCompare(r):n-r)){"desc"===i[e].order&&(h*=-1);break}}return h};return{publicApi:t}},S=t=>{const s=new Blob([A(t.toString())]),i=window.URL.createObjectURL(s);return new Worker(i)},A=t=>{const s=t.split("{").slice(1).join("{"),i=s.split("return");return s.split("return").slice(0,i.length-1).join("return")};class z{constructor(t){this.data=t}async patch(t){for(const s in t.patch)t.patch.hasOwnProperty(s)&&t.patch[s].forEach(i=>this[s](i,t));return t.patch.create||t.patch.update?this.sort(t):this.paginate(t)}create(t){this.data.unshift(t)}delete(t){this.data=this.data.filter(s=>s!==t)}update(t,s){const i=this.data.findIndex(i=>i[s.key]===t[s.key]);this.data[i]=t}}class P extends z{constructor(t){super(Array.isArray(t)?t:void 0),this.remoteOperations={},Array.isArray(t)||(Object.assign(this,t),this.load=t.load)}async fetchData(t){return this.paginate(t,this.sort(t,this.load(t)))}async load(t){if(t)return this.localLoad(t)}async paginate(t,s){if(!s&&this.remoteOperations.paging)return this.fetchData(t);let i=await s||await this.localLoad();return i.data&&(this.data=i.data),i.filtered&&(this.filtered=i.filtered,i={data:i.filtered,total:i.total}),!t.range||this.remoteOperations.paging?i:{data:i.data.slice(t.range[0],t.range[0]+t.size),total:i.total}}async sort(t,s){return!s&&this.remoteOperations.sorting?this.fetchData(t):s?!this.remoteOperations.sorting&&(t.sort||t.filter||t.group)?this.asyncSort(t,s):s:this.paginate(t,this.asyncSort(t,this.localLoad(t)))}async asyncSort(t,s){const i=await s;return new Promise(s=>(this.worker=this.connect(s),this.delayStart([t,i])))}async localLoad(t){return{data:t?this.data:void 0,filtered:!t&&this.filtered?this.filtered:this.data,total:!t&&this.filtered?this.filtered.length:this.data.length}}async delayStart(t){return new Promise(s=>{window.setTimeout(()=>{this.worker.postMessage(t),s()})})}connect(t){const s=S(O);return s.onmessage=s=>{t(s.data),this.disconnect()},s}disconnect(){this.worker&&(this.worker.terminate(),this.worker=void 0)}}class _ extends z{constructor(t){super(t),this.processor=O().publicApi}async fetchData(t){return this.paginate(t,this.sort(t,this.load(t)))}async load(t){return{data:this.data,filtered:!t&&this.filtered?this.filtered:this.data,total:!t&&this.filtered?this.filtered.length:this.data.length}}async paginate(t,s){let i=await s||await this.load(t);return i.data&&(this.data=i.data),i.filtered&&(this.filtered=i.filtered,i={data:i.filtered,total:i.total}),t.range?{data:i.data.slice(t.range[0],t.range[0]+t.size),total:i.total}:i}async sort(t,s){return s?t.sort||t.filter||t.group?this.processData(t,s):s:this.paginate(t,this.processData(t,this.load(t)))}async processData(t,s){const i=await s;return this.processor(i,t)}}class k{cellTemplate(t,s,i,h,e,n){t&&void 0!==e&&(this.fromTemplate(n,t,h,e),i.initCell(t,s))}rowTemplate(t,s,i,h){return this.fromTemplate(t,s,i,h)}fromTemplate(t,s,i,h){t&&s&&void 0!==h&&(s.innerHTML=H(t,i))}}const H=(t,s)=>t.split(/\${(.*?)}/g).reduce((i="",h)=>i+(h=t.includes("${"+h+"}")?I(s,h.replace("row.","")):h)),I=(t,s)=>{const i=Array.isArray(s)?s:s.split(".");return 0===s.length?t:I(t[i[0]],i.slice(1))};class ${constructor(t,s={},i){this.table=t,this.translator=i,this.cellRenderer=j.renderCell,this.dataType="string",this.defaultValue="",this.editable=!0,this.filterable=!0,this.filterTypes=g,this.groupKey="items",this.headerRenderer=j.renderHeader,this.internal=!1,this.pinnable=!0,this.pinned=null,this.orderable=!0,this.rules=[],this.selectable=!0,this.sizable=!0,this.sortable=!0,this.width="auto",this.visible=!0,this.renderer=new j(this),"string"==typeof s?this.field=s:Object.assign(this,s),this.name||(this.name=j.generateColumnName(this.field,this.caption)),this.editRenderer||(this.editRenderer=j.renderEdit.bind({translator:this.translator}))}async contextMenu(){return this.renderer.contextMenu()}async setOffset(t){return this.renderer.setOffset(t)}async setWidth(t){return this.renderer.setWidth(t)}async initCell(t,s){return this.renderer.initCell(t,s)}}const M=({columns:t})=>h("colgroup",null,t.map(t=>h("col",{class:j.classFromColumnName(t.name),span:t.span}))),W=(t,s)=>h("tbody",{class:t.classList},s);var U;!function(t){t.SORT_ASC="Press enter to sort column ascending",t.SORT_DESC="Press enter to sort column descending"}(U||(U={}));const F=({classList:t,column:s,columnIndex:i,filtering:e,offset:n,translator:r})=>{const o=s.span?{colspan:s.span}:{},a=r(void 0===s.sortOrder||"asc"===s.sortOrder?U.SORT_DESC:U.SORT_ASC);return h("th",Object.assign({},o,{class:t,tabIndex:s.sortable?0:-1,"aria-label":`${s.caption||s.field}: ${s.sortable?a:void 0}`,"data-column-index":i,ref:t=>s.initCell(t,n)}),"number"===s.dataType?h("anj-column-control",{column:s,field:s.field,sortIndex:s.sortIndex,sortOrder:s.sortOrder,pinned:s.pinned}):void 0,s.headerFormatter?h("span",{class:d.caption,innerHTML:s.headerFormatter(s.field,s.caption)}):h("span",{class:d.caption},s.headerRenderer(s.field,s.caption)),"number"!==s.dataType?h("anj-column-control",{column:s,field:s.field,sortIndex:s.sortIndex,sortOrder:s.sortOrder,pinned:s.pinned}):void 0,e&&s.filterable?h("anj-column-filter-toggle",{types:s.filterTypes,filter:s.filter,field:s.field,dataType:s.dataType}):void 0)},N=({columns:t,filtering:s,offsets:i,pinBoundaries:e,translator:n})=>h("thead",{class:d.header},h("tr",{class:d.row},t.map((t,r)=>{const o=c(j.columnHeaderClasses(t),j.pinnedBorderClass(r,e));return h(F,{classList:o,column:t,columnIndex:r,filtering:s,offset:i[r],translator:n})}))),B={when:()=>!0,cell:t=>h(b,Object.assign({},t))},V={when:()=>!0,row:t=>h(v,Object.assign({},t))};let X=0;const Y=class{constructor(s){t(this,s),this.cellMouseOverListener=t=>this.highlightColumn(t),this.cellMouseOutListener=t=>this.clearColumnHighlight(t),this.cellRenderers=[B],this.id=`anj-table-${X++}`,this.inited=!1,this.rowRenderers=[V],this.columnWidth="auto",this.height="auto",this.highlight="rows",this.implicitColumns=!1,this.name=this.id,this.orderable=!1,this.renderer=new k,this.selectedColumnFields=[],this.selectedRowKeys=[],this.sizable=!1,this.anjColumnsDidLoad=i(this,"anjColumnsDidLoad",7),this.anjColumnsDidUpdate=i(this,"anjColumnsDidUpdate",7),this.anjRowsWillLoad=i(this,"anjRowsWillLoad",7),this.anjRowsDidLoad=i(this,"anjRowsDidLoad",7),this.anjTableWillUpdate=i(this,"anjTableWillUpdate",7),this.anjTableDidUpdate=i(this,"anjTableDidUpdate",7)}get pagerOptions(){return this.pager?{page:this.pager.page,range:this.pager.range,size:this.pager.size}:{}}set pagerOptions(t){this.pager&&(this.pager.page=t.page,this.pager.size=t.size,this.pager.range=t.range)}async onColumnsChange(){if(this.inited)return this.loadColumns()}async onDataSourceChange(){if(this.colDefs&&Array.isArray(this.dataSource))return this.source?this.updateData(this.dataSource):this.connectDataSource()}async componentDidLoad(){await this.loadColumns(),await this.connectDataSource(),this.inited=!0}componentWillUpdate(){"columns"===this.highlight&&Array.from(this.element.querySelectorAll("td, th")).forEach(t=>{t.removeEventListener("mouseenter",this.cellMouseOverListener),t.removeEventListener("mouseleave",this.cellMouseOutListener)}),this.anjTableWillUpdate.emit()}componentDidUpdate(){"columns"===this.highlight&&Array.from(this.element.querySelectorAll("td, th")).forEach(t=>{t.addEventListener("mouseenter",this.cellMouseOverListener),t.addEventListener("mouseleave",this.cellMouseOutListener)}),this.colDefs&&"auto-fix"===this.columnWidth&&this.colDefs.filter(t=>t.visible&&"auto"===t.width).forEach(t=>{const s=j.classFromColumnName(t.name),i=this.element.querySelector(`td.${s}`);t.width=i?`${i.offsetWidth}px`:"auto"}),this.anjTableDidUpdate.emit()}componentDidUnload(){this.componentWillUpdate()}onControlLoaded(t){t.stopPropagation();const s=t.target;switch(s.tagName){case"ANJ-FILTER":this.filter=t.detail;break;case"ANJ-COLUMN-FILTERING":this.filtering=t.target;break;case"ANJ-STATE-STORE":this.store=t.target;break;default:this.pager=s}}onRowControlLoaded(t){t.stopPropagation();const s=t.target;this.rowRenderers.unshift(s),"ANJ-ROW-GROUPING"===s.tagName&&(this.rowGroupControl=s)}onCellControlLoaded(t){t.stopPropagation(),this.cellRenderers.unshift(t.target)}async onColumnToggle({detail:t}){const s=this.colDefs.find(s=>s.name===t);return s.visible=!s.visible,this.colDefs=this.groupColumns(this.colDefs),this.scroller.doResize()}onOrderChange({detail:t}){const s=this.colDefs.slice(0),i=s.splice(t.currentIndex,1)[0];i.pinned=s[t.targetIndex].pinned,s.splice(t.targetIndex,0,i),this.colDefs=this.groupColumns(s)}onPinChange({detail:t}){this.colDefs[t.index].pinned=t.pin,this.colDefs=this.groupColumns(this.colDefs)}async persistState(){if(!this.store)return;const t=await this.dataOptions(!1);return t&&this.colDefs?(t.columns=this.colDefs.map(m),this.store.set(t)):void 0}async onRowChange(t){if(t.target!==this.element&&t.stopPropagation(),"anjColumnsDidUpdate"===t.type||"anjRowsDidLoad"===t.type)return this.persistState()}async onPage(){return this.setRows(this.spinner.spinWhile(this.source.paginate(await this.dataOptions())))}async onColumnGroupChange(){return this.anjRowsWillLoad.emit(),this.setRows(this.spinner.spinWhile(this.source.sort(await this.dataOptions())))}async onSort(t){if(this.isChild(t.target))return this.anjRowsWillLoad.emit(),t.detail.field&&(this.colDefs=this.colDefs.map(s=>(t.detail.type?s.field===t.detail.field&&(s.filter=l(t.detail.query)?t.detail:void 0):(s.sortIndex=s.field===t.detail.field?0:void 0,s.sortOrder=s.field===t.detail.field?t.detail.order:"asc"),s))),this.pager&&(this.pager.page=1),this.setRows(this.spinner.spinWhile(this.source.sort(await this.dataOptions())))}addRow({detail:t,target:s}){if("noop"!==s.mode)if(t.index){const s=this.rows.slice(0);s.splice(t.index,0,t.data),this.rows=s}else this.rows=[t.data].concat(this.rows)}onDelete({detail:t,target:s}){if("noop"===s.mode)return;const i=this.rows.slice(0);i.splice(t.index,1),this.rows=i}async updateRow({detail:t}){const s=this.rows.slice(0);s[t.index]=t.data,this.rows=s}async patchData({detail:t}){const s=await this.dataOptions();return this.setRows(this.spinner.spinWhile(this.source.patch(Object.assign(s,{patch:t}))))}async columnMenu(){return Array.from(this.element.querySelectorAll("anj-context-menu-item")).map(t=>t.cloneNode(!0))}async getColumns(){return this.colDefs}async getRows(){return this.rows}async updateData(t){return this.source.data=t,this.loadRowData()}async scrollByKey(t,s){const i=s?this.rows.findIndex(t=>t[this.rowKey]===s):0,h=t?this.colDefs.findIndex(s=>s.field===t):0;return this.scrollByIndex(h,i)}async scrollByIndex(t,s){const i=this.element.querySelectorAll("tr")[s],h=this.element.querySelectorAll("th")[t],e=i.offsetTop+i.clientHeight,n=h.offsetWidth+h.offsetLeft;let r,o;return e>this.scroller.clientHeight+this.scroller.scrollTop?r=e-this.scroller.clientHeight:e<this.element.scrollTop+this.element.clientHeight&&(r=this.scroller.scrollTop-i.clientHeight>-1?this.scroller.scrollTop-i.clientHeight:0),n>this.scroller.scrollLeft+this.scroller.offsetWidth?o=n-this.scroller.offsetWidth:n<this.scroller.scrollLeft+this.scroller.offsetWidth&&(o=this.scroller.scrollLeft-h.offsetWidth>-1?this.scroller.scrollLeft-h.offsetWidth:0),this.scroller.debouncedScrollTo(o,r)}connectDataSource(){if(this.dataSource)return this.source=Array.isArray(this.dataSource)&&this.dataSource.length<1e3?new _(this.dataSource):new P(this.dataSource),this.loadRowData()}async loadRowData(){return this.setRows(this.spinner.spinWhile(this.source.fetchData(await this.dataOptions(!0))))}async loadColumns(){const t=await Promise.all(Array.from(this.element.querySelectorAll("anj-column")).filter(t=>this.isChild(t)).map(t=>t.componentOnReady())),s=this.store&&!this.colDefs?await this.loadColumnsFromStore():void 0;this.colDefs=this.groupColumns(t.concat(this.loadMetaColumns()),s)}loadMetaColumns(){return this.columns?this.columns.map(t=>new $(this.element,t,this.translator)):[]}groupColumns(t,s){const i=s?this.initColumnsFromStore(t,s):t,h=i.filter(G),e=h.filter(t=>"left"===t.pinned),n=h.filter(t=>"right"===t.pinned),r=h.filter(t=>!t.pinned),o=e.concat(r,n),a=o.concat(i.filter(t=>!t.visible||void 0!==t.groupIndex)).map((t,s)=>(t.index=s,t));return this.pinBoundaries=p(e.length,n.length,r.length),this.offsets=w(o),this.colDefs?this.anjColumnsDidUpdate.emit(a):this.anjColumnsDidLoad.emit(a),a}async loadColumnsFromStore(){const t=await this.store.get();return t&&t.columns?t.columns:void 0}initColumnsFromStore(t,s){return t.map(t=>{const i=s.find(s=>s.name===t.name);return i?Object.assign(t,i):t}).sort((t,s)=>t.index-s.index)}isChild(t){return t.closest(this.element.tagName).name===this.name}async setRows(t){try{const s=await t;this.implicitColumns&&0===this.colDefs.filter(t=>!t.internal).length&&s.data&&s.data.length>0&&(this.columns=f(Object.keys(s.data[0]),s.data),await this.loadColumns()),this.rows=s.data||[],this.pager&&(this.pager.total=s.total||0),this.anjRowsDidLoad.emit()}catch(s){throw s}}async dataOptions(t=!1){if(t&&this.store)return this.initOptionsFromStore();const s={key:this.rowKey},i=this.colDefs.filter(t=>t.sortIndex>-1).sort((t,s)=>t.sortIndex-s.sortIndex).map(t=>({key:t.field,order:t.sortOrder,index:t.sortIndex})),h=this.colDefs.filter(t=>t.groupIndex>-1).sort((t,s)=>t.groupIndex-s.groupIndex).map(t=>({groupKeys:t.groupKeys,key:t.field,groupKey:t.groupKey,index:t.groupIndex,autoExpand:this.rowGroupControl.autoExpand})),e=this.colDefs.filter(t=>t.filter).map(t=>({key:t.field,query:t.filter.query,type:t.filter.type}));return this.filter&&this.filter.value&&e.unshift({type:"contains",query:this.filter.value||"",key:void 0}),Object.assign({filter:e.length>0?e:void 0,group:h.length>0?h:void 0,sort:i.length>0?i:void 0},this.pagerOptions,s)}async initOptionsFromStore(){const t=await this.store.get();return t?(this.filter&&t.filter&&!t.filter[0].key&&(this.filter.value=t.filter[0].query),this.pager&&(this.pagerOptions=t),t.sort&&t.sort.forEach(t=>{const s=this.colDefs.find(s=>s.field===t.key);s.sortIndex=t.index,s.sortOrder=t.order}),t):this.dataOptions()}highlightColumn({target:t}){y(t).forEach(t=>t.classList.add("anj-highlight"))}clearColumnHighlight({target:t}){y(t).forEach(t=>t.classList.remove("anj-highlight"))}getRowRenderer(t,s,i){const h={cellRenderers:this.cellRenderers,columns:i,offsets:this.offsets,pinBoundaries:this.pinBoundaries,renderer:this.renderer,row:t,rowIndex:s};return this.rowRenderers.find(s=>s.when(t)).row(h)}render(){const t=this.colDefs?this.colDefs.filter(G):void 0;return[h("div",{class:"anj-table-header"},h("div",{class:"anj-table-filter"},h("slot",{name:"filter"})),h("div",{class:"anj-table-controls"},h("slot",null))),t&&this.rows?h("anj-scroller",{style:{maxHeight:this.height},ref:t=>this.scroller=t},h("table",{class:d.table},h(M,{columns:t}),h(N,{columns:t,filtering:!!this.filtering,offsets:this.offsets,pinBoundaries:this.pinBoundaries,translator:this.translator}),h(W,{classList:d.body},this.rows.map((s,i)=>this.getRowRenderer(s,i,t))))):void 0,h("div",{style:{display:this.rows&&0===this.rows.length?"block":"none"}},h("slot",{name:"footer-message"})),h("slot",{name:"footer"}),h("anj-spinner-controller",{ref:t=>this.spinner=t})]}get element(){return s(this)}static get watchers(){return{columns:["onColumnsChange"],dataSource:["onDataSourceChange"]}}static get style(){return".anj-base-table,anj-table .anj-table{border-collapse:separate;border-spacing:0;min-width:100%;max-width:none;position:relative;table-layout:fixed}.anj-base-table,.anj-base-table tbody,.anj-base-table td,.anj-base-table th,.anj-base-table thead,.anj-base-table tr,anj-table .anj-table,anj-table .anj-table tbody,anj-table .anj-table td,anj-table .anj-table th,anj-table .anj-table thead,anj-table .anj-table tr{background-color:inherit}.anj-base-table>thead th,anj-table .anj-table>thead th{color:var(--anj-neutral-dark);cursor:default;font-size:.75rem;-webkit-transition:border-color .3s ease,color .3s ease,-webkit-transform .3s ease;transition:border-color .3s ease,color .3s ease,-webkit-transform .3s ease;transition:border-color .3s ease,color .3s ease,transform .3s ease;transition:border-color .3s ease,color .3s ease,transform .3s ease,-webkit-transform .3s ease}.anj-base-table>thead th.anj-overflow-header .anj-column-caption,anj-table .anj-table>thead th.anj-overflow-header .anj-column-caption{overflow:visible;white-space:normal}.anj-base-table>thead th>span,anj-table .anj-table>thead th>span{display:inline-block;line-height:1;max-width:100%;padding-right:.25rem;overflow:hidden;text-overflow:ellipsis;text-transform:uppercase}.anj-base-table>tbody td,.anj-base-table>tbody th,anj-table .anj-table>tbody td,anj-table .anj-table>tbody th{cursor:default;overflow:hidden;text-overflow:ellipsis;-webkit-transition:border-color .3s ease;transition:border-color .3s ease}.anj-base-table>tbody td.anj-pinned-left,.anj-base-table>tbody th.anj-pinned-left,anj-table .anj-table>tbody td.anj-pinned-left,anj-table .anj-table>tbody th.anj-pinned-left{z-index:1}.anj-base-table>tbody td.anj-overflow-cell,.anj-base-table>tbody th.anj-overflow-cell,anj-table .anj-table>tbody td.anj-overflow-cell,anj-table .anj-table>tbody th.anj-overflow-cell{overflow:visible;white-space:normal}.anj-base-table>tbody td,.anj-base-table>tbody th,.anj-base-table>thead th,anj-table .anj-table>tbody td,anj-table .anj-table>tbody th,anj-table .anj-table>thead th{border-bottom:1px solid var(--anj-border);border-left:0;border-right:0;border-top:0;padding:.657rem .75rem;vertical-align:top;white-space:nowrap}.anj-base-table>tbody td:focus,.anj-base-table>tbody th:focus,.anj-base-table>thead th:focus,anj-table .anj-table>tbody td:focus,anj-table .anj-table>tbody th:focus,anj-table .anj-table>thead th:focus{border-bottom-color:#b8c1ca;outline:none}.anj-base-table>tbody td.anj-pinned-left,.anj-base-table>tbody td.anj-pinned-right,.anj-base-table>tbody th.anj-pinned-left,.anj-base-table>tbody th.anj-pinned-right,.anj-base-table>thead th.anj-pinned-left,.anj-base-table>thead th.anj-pinned-right,anj-table .anj-table>tbody td.anj-pinned-left,anj-table .anj-table>tbody td.anj-pinned-right,anj-table .anj-table>tbody th.anj-pinned-left,anj-table .anj-table>tbody th.anj-pinned-right,anj-table .anj-table>thead th.anj-pinned-left,anj-table .anj-table>thead th.anj-pinned-right{position:-webkit-sticky;position:sticky}.anj-base-table>tbody td.anj-pin-border.anj-pinned-left,.anj-base-table>tbody th.anj-pin-border.anj-pinned-left,.anj-base-table>thead th.anj-pin-border.anj-pinned-left,anj-table .anj-table>tbody td.anj-pin-border.anj-pinned-left,anj-table .anj-table>tbody th.anj-pin-border.anj-pinned-left,anj-table .anj-table>thead th.anj-pin-border.anj-pinned-left{border-right:1px solid transparent}.anj-base-table>tbody td.anj-pin-border.anj-pinned-right,.anj-base-table>tbody th.anj-pin-border.anj-pinned-right,.anj-base-table>thead th.anj-pin-border.anj-pinned-right,anj-table .anj-table>tbody td.anj-pin-border.anj-pinned-right,anj-table .anj-table>tbody th.anj-pin-border.anj-pinned-right,anj-table .anj-table>thead th.anj-pin-border.anj-pinned-right{border-left:1px solid transparent}.anj-base-table>tbody td anj-button,.anj-base-table>tbody th anj-button,.anj-base-table>thead th anj-button,anj-table .anj-table>tbody td anj-button,anj-table .anj-table>tbody th anj-button,anj-table .anj-table>thead th anj-button{margin:-.75rem 0!important}.anj-base-table>thead th,anj-table .anj-table>thead th{position:-webkit-sticky;position:sticky;top:0;z-index:1}.anj-base-table>thead th:focus .anj-column-caption,anj-table .anj-table>thead th:focus .anj-column-caption{color:var(--anj-text)}.anj-base-table>thead th.anj-pinned-left,.anj-base-table>thead th.anj-pinned-right,anj-table .anj-table>thead th.anj-pinned-left,anj-table .anj-table>thead th.anj-pinned-right{z-index:2}\@supports not ((position:-webkit-sticky) or (position:sticky)){.anj-base-table .anj-header-cell,.anj-base-table .anj-pinned-left,.anj-base-table .anj-pinned-right,anj-table .anj-table .anj-header-cell,anj-table .anj-table .anj-pinned-left,anj-table .anj-table .anj-pinned-right{position:relative;bottom:auto!important;left:auto!important;right:auto!important;top:auto!important}}anj-table{display:block;font-size:.875rem;font-family:var(--anj-font-family);font-weight:400;line-height:1.5;outline:none;background-color:var(--anj-light);position:relative}anj-table,anj-table:after,anj-table:before{-webkit-box-sizing:border-box;box-sizing:border-box;outline:none}anj-table:active,anj-table :active,anj-table:focus,anj-table :focus{outline:none}anj-table[highlight=cells] tbody td{-webkit-transition:border-color .3s ease,background-color .3s ease,color .3s ease;transition:border-color .3s ease,background-color .3s ease,color .3s ease}anj-table[highlight=cells] tbody td:hover{background-color:#f7f8f9}anj-table[highlight=columns] .anj-table .anj-header-cell.anj-selectable{-webkit-transition:border-color .3s ease,background-color .3s ease,color .3s ease,-webkit-transform .3s ease;transition:border-color .3s ease,background-color .3s ease,color .3s ease,-webkit-transform .3s ease;transition:border-color .3s ease,background-color .3s ease,color .3s ease,transform .3s ease;transition:border-color .3s ease,background-color .3s ease,color .3s ease,transform .3s ease,-webkit-transform .3s ease}anj-table[highlight=columns] .anj-table .anj-header-cell.anj-selectable.anj-highlight{background-color:#f7f8f9}anj-table[highlight=columns] .anj-table .anj-cell.anj-selectable{-webkit-transition:border-color .3s ease,background-color .3s ease,color .3s ease;transition:border-color .3s ease,background-color .3s ease,color .3s ease}anj-table[highlight=columns] .anj-table .anj-cell.anj-selectable.anj-highlight{background-color:#f7f8f9}anj-table[highlight=rows] tbody>tr{-webkit-transition:background-color .3s ease;transition:background-color .3s ease}anj-table[highlight=rows] tbody>tr:focus,anj-table[highlight=rows] tbody>tr:hover{background-color:#f7f8f9}anj-table[orderable] .anj-header-cell{cursor:pointer}anj-table anj-button-group{display:block}anj-table .anj-table-header{display:-ms-flexbox;display:flex;-ms-flex:1;flex:1;-ms-flex-flow:column-reverse;flex-flow:column-reverse;position:relative;z-index:3}anj-table .anj-table-header .anj-table-controls{display:-ms-flexbox;display:flex;-ms-flex:0 0 100%;flex:0 0 100%;-ms-flex-pack:end;justify-content:flex-end;max-width:100%}anj-table .anj-table-header .anj-table-controls anj-button{margin-bottom:1rem}\@media (min-width:768px){anj-table .anj-table-header{-ms-flex-flow:row wrap;flex-flow:row wrap}anj-table .anj-table-header .anj-table-controls,anj-table .anj-table-header .anj-table-filter{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}}anj-table anj-scroller.anj-overflow-x .anj-cell.anj-pin-border.anj-pinned-left,anj-table anj-scroller.anj-overflow-x .anj-header-cell.anj-pin-border.anj-pinned-left{border-right-color:var(--anj-border)}anj-table anj-scroller.anj-overflow-x .anj-cell.anj-pin-border.anj-pinned-right,anj-table anj-scroller.anj-overflow-x .anj-header-cell.anj-pin-border.anj-pinned-right{border-left-color:var(--anj-border)}anj-table .anj-table .anj-datatype-boolean{text-align:center}anj-table .anj-table .anj-datatype-number{text-align:right}anj-table .anj-table .anj-datatype-number .anj-column-caption{padding-left:.25rem;padding-right:0}"}};u.injectProps(Y,["dateFormatter","datetimeFormatter","numberFormatter","translator"]);const G=t=>t.visible&&void 0===t.groupIndex,J=class{constructor(s){t(this,s)}static get style(){return"anj-table-message{color:var(--anj-neutral);display:block;padding:.657rem .75rem;text-align:center}"}};export{C as anj_column,L as anj_column_control,D as anj_column_sizer,E as anj_scroller,Y as anj_table,J as anj_table_message};